<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lawnroad.broadcast.live.mapper.ScheduleMapper">

    <insert id="insertSchedule" parameterType="com.lawnroad.broadcast.live.model.ScheduleVo" useGeneratedKeys="true" keyProperty="no">
        INSERT INTO broadcast_schedule (
        user_no, category_no, name, content, thumbnail_path, date, start_time, end_time, created_at
        )
        VALUES (
        #{userNo}, #{categoryNo}, #{name}, #{content}, #{thumbnailPath}, #{date}, #{startTime}, #{endTime}, NOW()
        )
    </insert>

    <select id="findAllByDate" resultType="com.lawnroad.broadcast.live.dto.ScheduleDateDto">
        SELECT bs.no,
        bs.name,
        bs.content,
        bs.date,
        bs.start_time,
        bs.end_time,
        l.name AS lawyer_name
        FROM broadcast_schedule bs
        JOIN user u ON (bs.user_no = u.no)
        JOIN lawyer l ON (u.no = l.no)
        WHERE date = #{date}
        ORDER BY bs.start_time
    </select>

    <select id="findAllByMonth" resultType="com.lawnroad.broadcast.live.dto.ScheduleCalendarDto">
        SELECT
        bs.no AS scheduleNo,
        bs.name AS title,
        bs.date,
        bs.start_time,
        l.name AS lawyer_name
        FROM broadcast_schedule bs
        JOIN user u ON (bs.user_no = u.no)
        JOIN lawyer l ON (u.no = l.no)
        WHERE DATE_FORMAT(bs.date, '%Y-%m') = #{month}
        ORDER BY bs.date, bs.start_time
    </select>

</mapper>