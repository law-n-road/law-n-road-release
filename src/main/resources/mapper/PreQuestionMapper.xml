<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lawnroad.broadcast.chat.mapper.PreQuestionMapper">

    <!-- DTO 매핑에 맞춘 resultMap 정의 -->
    <resultMap id="PreQuestionResultMap" type="com.lawnroad.broadcast.chat.dto.PreQuestionDTO">
        <result property="categoryNo"     column="category_no"/>
        <result property="lawyerName"     column="lawyer_name"/>
        <result property="name"           column="name"/> <!-- title → name -->
        <result property="content"        column="content"/>
        <result property="thumbnailPath"  column="thumbnail_path"/>
        <result property="date"           column="date"/>
        <result property="startTime"      column="start_time"/>
        <result property="endTime"        column="end_time"/>
        <collection property="keywords" ofType="string" column="schedule_no"
                    select="findKeywordsBySchedule"/>
    </resultMap>

    <!-- 메인 쿼리 -->
    <select id="findBySchedule" resultMap="PreQuestionResultMap">
        SELECT
        bs.category_no,
        l.name AS lawyer_name,
        bs.name,
        bs.content,
        bs.thumbnail_path,
        bs.date,
        bs.start_time,
        bs.end_time,
        bs.no AS schedule_no
        FROM broadcast_schedule bs
        JOIN lawyer l ON bs.user_no = l.no
        WHERE bs.no = #{scheduleNo}
    </select>

    <!-- 키워드 조회 서브 쿼리 -->
    <select id="findKeywordsBySchedule" resultType="string">
        SELECT keyword
        FROM keyword
        WHERE schedule_no = #{schedule_no}
    </select>

</mapper>
