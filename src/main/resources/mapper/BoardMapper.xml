<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lawnroad.board.mapper.BoardMapper">

    <!-- 게시글 목록 조회 -->
    <resultMap id="BoardListMap" type="com.lawnroad.board.dto.BoardListDto">
        <result property="no"          column="no"/>
        <result property="categoryNo"  column="category_no"/>
        <result property="userNo"      column="user_no"/>
        <result property="title"       column="title"/>
        <result property="summary"     column="summary"/>
        <result property="incidentDate" column="incident_date"/>
        <result property="createdAt"   column="created_at"/>
    </resultMap>

    <select id="selectBoardList" resultMap="BoardListMap" parameterType="map">
        SELECT
        b.no,
        b.category_no,
        b.user_no,
        b.title,
        LEFT(b.content, 100) AS summary,
        b.incident_date,
        b.created_at
        FROM board b
        ORDER BY b.created_at DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 게시글 총 개수 조회 -->
    <select id="getBoardCount" resultType="int">
        SELECT COUNT(*) FROM board
    </select>

<!--    &lt;!&ndash; 게시글 상세 조회: 카테고리명/사용자명 조인 포함 &ndash;&gt;-->
<!--    <resultMap id="BoardDetailMap" type="com.lawnroad.board.dto.BoardDetailDto">-->
<!--        <id property="no" column="no"/>-->
<!--        <result property="categoryNo" column="category_no"/>-->
<!--        <result property="categoryName" column="category_name"/>-->
<!--        <result property="userNo" column="user_no"/>-->
<!--        <result property="userName" column="user_name"/>-->
<!--        <result property="title" column="title"/>-->
<!--        <result property="content" column="content"/>-->
<!--        <result property="incidentDate" column="incident_date"/>-->
<!--        <result property="createdAt" column="created_at"/>-->
<!--        <result property="updatedAt" column="updated_at"/>-->
<!--    </resultMap>-->

<!--    <select id="selectBoardById" resultMap="BoardDetailMap" parameterType="long">-->
<!--        SELECT-->
<!--        b.no,-->
<!--        b.category_no,-->
<!--        c.name AS category_name,-->
<!--        b.user_no,-->
<!--        u.name AS user_name,-->
<!--        b.title,-->
<!--        b.content,-->
<!--        b.incident_date,-->
<!--        b.created_at,-->
<!--        b.updated_at-->
<!--        FROM board b-->
<!--        LEFT JOIN category c ON b.category_no = c.no-->
<!--        LEFT JOIN user u ON b.user_no = u.no-->
<!--        WHERE b.no = #{no}-->
<!--    </select>-->

<!--    &lt;!&ndash; 게시글 생성 &ndash;&gt;-->
<!--    <insert id="insertBoard" parameterType="BoardCreateDto" useGeneratedKeys="true" keyProperty="no">-->
<!--        INSERT INTO board (-->
<!--        category_no,-->
<!--        user_no,-->
<!--        title,-->
<!--        content,-->
<!--        incident_date,-->
<!--        created_at,-->
<!--        updated_at-->
<!--        ) VALUES (-->
<!--        #{categoryNo},-->
<!--        #{userNo},-->
<!--        #{title},-->
<!--        #{content},-->
<!--        #{incidentDate},-->
<!--        NOW(),-->
<!--        NOW()-->
<!--        )-->
<!--    </insert>-->

<!--    &lt;!&ndash; 게시글 수정 &ndash;&gt;-->
<!--    <update id="updateBoard" parameterType="BoardUpdateDto">-->
<!--        UPDATE board-->
<!--        SET-->
<!--        category_no   = #{categoryNo},-->
<!--        title         = #{title},-->
<!--        content       = #{content},-->
<!--        incident_date = #{incidentDate},-->
<!--        updated_at    = NOW()-->
<!--        WHERE no = #{no}-->
<!--    </update>-->

<!--    &lt;!&ndash; 게시글 삭제 &ndash;&gt;-->
<!--    <delete id="deleteBoard" parameterType="long">-->
<!--        DELETE FROM board WHERE no = #{no}-->
<!--    </delete>-->

</mapper>
